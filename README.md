# Challenge Lab: Enhancing the GenAI Chatbot with DALL-E Image Generation

In this challenge lab, you'll enhance an existing Flask-based web application by integrating DALL-E to generate and display images based on user requests for recipes. This lab will test your ability to work with APIs, modify web application code, and create a seamless user experience.

---

## Lab Overview

In this lab, you'll start with a basic AI-powered chatbot that uses OpenAI's GPT-4 to generate responses. Your challenge is to modify the application to call DALL-E and generate images of the recipes users ask for, then display these images on the web interface.

---

## Instructions

### Step 1: Update `index.html`

- **Task:** Modify the HTML template to include a section for displaying the generated image.
- **Instructions:** In `index.html`, add an `<img>` tag that will dynamically display the image generated by DALL-E. Ensure this image updates when a new recipe is requested.

  Example:

  ```html
  <img
    id="recipe-image"
    src="{{ url_for('static', filename='images/placeholder.png') }}"
    alt="Recipe Image"
  />
  ```

  - Ensure the `id` of the image tag matches the one you'll use in your Flask route to update the image source dynamically.

### Step 2: Update `app.py`

- **Task:** Modify the Flask application to generate images using DALL-E and serve them to the frontend.
- **Instructions:**

  1. **Integrate DALL-E Image Generation:**

     - Update the `generate_image()` function in `app.py` to call the DALL-E API and generate an image based on the user's recipe request.

  2. **Serve the Generated Image:**
     - Ensure the generated image is saved in the `static/images` directory.
     - Update the `/chat` route to include the image URL in the response JSON, so the frontend can update the displayed image dynamically.

  Example code snippet:

  ```python
  def generate_image(prompt):
      try:
          response = openai.Image.create(
              prompt=prompt,
              n=1,
              size="1024x1024"
          )
          image_url = response['data'][0]['url']
          image_filename = f"{uuid4()}.png"
          image_path = os.path.join('static/images', image_filename)

          # Download and save the image
          img_data = requests.get(image_url).content
          with open(image_path, 'wb') as f:
              f.write(img_data)

          return image_filename
      except Exception as e:
          print(f"Error generating image: {e}")
          return None
  ```

  3. **Return the Image URL:**
     - Modify the JSON response in the `/chat` route to include the image URL.

  Example:

  ```python
  return jsonify({"response": ai_response, "image_url": f"/static/images/{image_filename}"})
  ```

### Step 3: Test Your Application

- **Task:** Run the Flask application locally and test the entire flow.
- **Instructions:** Verify that when a user inputs a recipe request, the application responds with both a recipe and a corresponding image generated by DALL-E, displayed on the web interface.

  ```bash
  python app.py
  ```

### Validation

Open your browser and go to [http://localhost:8080](http://localhost:8080). Input a recipe request and check that the image updates correctly on the page.

---

## Deployment

Once you have successfully implemented and tested the image generation feature:

1. **Deploy to Google App Engine**

   - Follow the instructions in the original README to deploy your enhanced application to Google App Engine.

2. **Verify Deployed Application**
   - Ensure the deployed version correctly generates and displays recipe images as expected.

---

## Conclusion

Completing this challenge will enhance your skills in API integration, web development, and creating dynamic user experiences. By the end of this lab, you'll have a fully functional, serverless GenAI chatbot that not only generates recipes but also visualizes them with DALL-E.

**Good luck, and happy coding!**
